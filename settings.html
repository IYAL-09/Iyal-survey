<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Settings – Iyal Surveys</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
body { font-family:'Segoe UI',sans-serif; margin:0; background:#f1f8e9; color:#2e7d32; }

header {
  background:#2e7d32;
  color:white;
  padding:15px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:relative;
}
.logo { display:flex; align-items:center; }
.logo img {
  width:50px; height:50px;
  border-radius:50%;
  border:3px solid white;
  margin-right:10px;
}
.logo span { font-size:1.2em; font-weight:bold; }

.menu-toggle { font-size:1.5em; cursor:pointer; }

nav {
  position:absolute;
  top:60px;
  right:15px;
  background:#388e3c;
  display:none;
  flex-direction:column;
  padding:10px;
  border-radius:8px;
  z-index:10;
}
nav a {
  color:white;
  text-decoration:none;
  padding:8px 0;
  border-bottom:1px solid #66bb6a;
}

.content { padding:20px; padding-bottom:120px; }

.card {
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  margin-bottom:20px;
}

h2 { margin-top:0; }

.input-group {
  position:relative;
  margin-bottom:15px;
}
.input-group i {
  position:absolute;
  top:50%;
  left:12px;
  transform:translateY(-50%);
  color:#4caf50;
}
.input-group input {
  width:100%;
  padding:12px 40px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:1em;
}
.eye {
  position:absolute;
  top:50%;
  right:12px;
  transform:translateY(-50%);
  cursor:pointer;
  color:#4caf50;
}

button {
  width:100%;
  padding:12px;
  background:#2e7d32;
  color:white;
  border:none;
  border-radius:8px;
  font-size:1em;
  font-weight:bold;
  cursor:pointer;
}

button:disabled {
  background:#9e9e9e;
  cursor:not-allowed;
}

#status {
  margin-top:10px;
  font-weight:bold;
  text-align:center;
}

.bottom-nav {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#2e7d32;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}
.bottom-nav a {
  color:white;
  text-decoration:none;
  font-size:0.9em;
  text-align:center;
}
.bottom-nav i {
  display:block;
  font-size:1.2em;
  margin-bottom:4px;
}
</style>
</head>

<body>

<header>
  <div class="logo">
    <img src="iyallogo.png">
    <span>Iyal Surveys</span>
  </div>
  <div class="menu-toggle" onclick="toggleMenu()">
    <i class="fa fa-bars"></i>
  </div>
  <nav id="menu">
    <a href="dashboard.html">Dashboard</a>
    <a href="referrals.html">Referrals</a>
    <a href="withdraw.html">Cash Out</a>
    <a href="#" id="logout">Logout</a>
  </nav>
</header>

<div class="content">
  <div class="card">
    <h2><i class="fa fa-lock"></i> Change Password</h2>

    <div class="input-group">
      <i class="fa fa-key"></i>
      <input type="password" id="oldPassword" placeholder="Old Password">
      <i class="fa fa-eye eye" onclick="toggle('oldPassword', this)"></i>
    </div>

    <div class="input-group">
      <i class="fa fa-lock"></i>
      <input type="password" id="newPassword" placeholder="New Password">
      <i class="fa fa-eye eye" onclick="toggle('newPassword', this)"></i>
    </div>

    <div class="input-group">
      <i class="fa fa-check"></i>
      <input type="password" id="confirmPassword" placeholder="Confirm New Password">
      <i class="fa fa-eye eye" onclick="toggle('confirmPassword', this)"></i>
    </div>

    <button id="updateBtn">Update Password</button>
    <p id="status"></p>
  </div>
</div>

<div class="bottom-nav">
  <a href="withdraw.html"><i class="fa fa-money-bill-wave"></i>Cash Out</a>
  <a href="referrals.html"><i class="fa fa-users"></i>Referrals</a>
  <a href="dashboard.html"><i class="fa fa-home"></i>Dashboard</a>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://xkshzlfducmnglxfnxzk.supabase.co",
  "YOUR_ANON_KEY"
);

/* MENU */
window.toggleMenu = () => {
  const m = document.getElementById("menu");
  m.style.display = m.style.display === "flex" ? "none" : "flex";
};

/* AUTH CHECK */
const { data:{ session } } = await supabase.auth.getSession();
if(!session) window.location.href="login.html";

/* SHOW/HIDE PASSWORD */
window.toggle = (id, el) => {
  const input = document.getElementById(id);
  input.type = input.type === "password" ? "text" : "password";
  el.classList.toggle("fa-eye-slash");
};

/* UPDATE PASSWORD */
document.getElementById("updateBtn").onclick = async () => {
  const oldP = document.getElementById("oldPassword").value;
  const newP = document.getElementById("newPassword").value;
  const confirmP = document.getElementById("confirmPassword").value;
  const status = document.getElementById("status");

  if(!oldP || !newP || !confirmP)
    return status.textContent="⚠️ Fill all fields";

  if(newP.length < 6)
    return status.textContent="⚠️ Password too short";

  if(newP !== confirmP)
    return status.textContent="⚠️ Passwords do not match";

  const { error } = await supabase.auth.updateUser({
    password: newP
  });

  if(error){
    status.style.color="red";
    status.textContent="❌ " + error.message;
  } else {
    status.style.color="green";
    status.textContent="✅ Password updated successfully";
    document.querySelectorAll("input").forEach(i=>i.value="");
  }
};

/* LOGOUT */
document.getElementById("logout").onclick = async () => {
  await supabase.auth.signOut();
  window.location.href="login.html";
};
</script>

</body>
</html>
