<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iyal Surveys - Tasks</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f1f8e9; }
    header, .bottom-nav { background: #2e7d32; color: white; }
    header { padding: 15px; display: flex; align-items: center; justify-content: space-between; position: relative; }
    .logo { display: flex; align-items: center; }
    .logo img { width: 40px; margin-right: 10px; }
    .logo span { font-size: 1.2em; font-weight: bold; }
    .menu-toggle { font-size: 1.5em; cursor: pointer; }
    nav { position: absolute; top: 60px; right: 15px; background: #388e3c; display: none; flex-direction: column; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); z-index: 10; }
    nav a { color: white; text-decoration: none; padding: 8px 0; border-bottom: 1px solid #66bb6a; }
    .content { padding: 20px; padding-bottom: 100px; }
    .video-box { background: white; padding: 10px; border-radius: 10px; box-shadow: 0 0 10px #ccc; margin-bottom: 20px; text-align: center; position: relative; overflow: hidden; }
    .ad-preview {
      filter: blur(6px);
      width: 250px;
      height: 250px;
      border-radius: 10px;
      object-fit: cover;
      display: block;
      margin: auto;
      transition: filter 0.3s ease;
    }
    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: rgba(0,0,0,0.4);
      color: white;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 10px;
      transition: opacity 0.3s ease;
    }
    .overlay i {
      font-size: 2em;
      margin-bottom: 5px;
    }
    .balance {
      background: #c8e6c9;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
      font-weight: bold;
      color: #2e7d32;
      position: relative;
    }
    .spinner {
      border: 4px solid #c8e6c9;
      border-top: 4px solid #2e7d32;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      margin: auto;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .popup {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #4caf50;
      color: white;
      padding: 12px 20px;
      border-radius: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
      font-size: 0.95em;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: 1000;
    }
    .popup.show { opacity: 1; }
    .countdown {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #2e7d32;
      color: white;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9em;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      display: none;
    }
    .loading-next {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: bold;
    }
    .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 5px rgba(0,0,0,0.2); }
    .bottom-nav a { color: white; text-decoration: none; font-size: 0.9em; text-align: center; }
    .bottom-nav i { display: block; font-size: 1.2em; margin-bottom: 4px; }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="assets/iyallogo.png" alt="Iyal Logo" />
      <span>Iyal Surveys</span>
    </div>
    <div class="menu-toggle" onclick="toggleMenu()"><i class="fa fa-bars"></i></div>
    <nav id="menu">
      <a href="dashboard.html">Dashboard</a>
      <a href="terms.html">Terms & Conditions</a>
      <a href="privacy.html">Privacy Policy</a>
      <a href="support.html">Support Page</a>
    </nav>
  </header>

  <div class="content">
    <div class="balance" id="balanceContainer">
      <div class="spinner" id="balanceSpinner"></div>
      <span id="balance" style="display:none;">Balance: ₦0</span>
    </div>
    <h2>Watch Ads & Earn ₦50 Each</h2>
    <p><strong>Note:</strong> You must watch at least 90% of each ad to earn ₦50.</p>

    <div class="video-box">
      <div class="countdown" id="countdown1">15</div>
      <img id="gif1" class="ad-preview" />
      <div class="overlay" id="overlay1" onclick="playAd(1)">
        <i class="fa fa-play-circle"></i>
        <span>Click to Watch Ad</span>
      </div>
      <div class="loading-next" id="loading1">Loading next ad...</div>
    </div>

    <div class="video-box">
      <div class="countdown" id="countdown2">15</div>
      <img id="gif2" class="ad-preview" />
      <div class="overlay" id="overlay2" onclick="playAd(2)">
        <i class="fa fa-play-circle"></i>
        <span>Click to Watch Ad</span>
      </div>
      <div class="loading-next" id="loading2">Loading next ad...</div>
    </div>
  </div>

  <div class="popup" id="popup"></div>

  <div class="bottom-nav">
    <a href="withdraw.html"><i class="fa fa-money-bill-wave"></i>Cash Out</a>
    <a href="referrals.html"><i class="fa fa-users"></i>Referrals</a>
    <a href="dashboard.html"><i class="fa fa-home"></i>Dashboard</a>
    <a href="login.html"><i class="fa fa-sign-out-alt"></i>Logout</a>
  </div>

  <script>
    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAyUuew-e4wlIdUDx7olNKx68sjD1UXY9U",
      authDomain: "iyal-survey.firebaseapp.com",
      projectId: "iyal-survey",
      storageBucket: "iyal-survey.appspot.com",
      messagingSenderId: "356060656195",
      appId: "1:356060656195:web:d0357a25774de984371af6",
      measurementId: "G-28XENM0B78"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const balance = document.getElementById("balance");
    const spinner = document.getElementById("balanceSpinner");
    const popup = document.getElementById("popup");

    let currentAd = null;
    const gifList = [
      "https://media.giphy.com/media/Ju7l5y9osyymQ/giphy.gif",
      "https://media.giphy.com/media/3o7aD4c6N3P2Ug2zra/giphy.gif",
      "https://media.giphy.com/media/l0HlTy9x8FZo0XO1i/giphy.gif",
      "https://media.giphy.com/media/3ohhwl1eSmYVJw6uuk/giphy.gif",
      "https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif"
    ];

    document.getElementById("gif1").src = gifList[Math.floor(Math.random()*gifList.length)];
    document.getElementById("gif2").src = gifList[Math.floor(Math.random()*gifList.length)];

    onAuthStateChanged(auth, (user) => {
      if (!user) return (window.location.href = "login.html");
      const userRef = doc(db, "users", user.uid);
      onSnapshot(userRef, (snap) => {
        const data = snap.data();
        spinner.style.display = "none";
        balance.style.display = "inline";
        balance.textContent = `Balance: ₦${(data?.balance || 0).toLocaleString()}`;
      });
    });

    function showPopup(msg) {
      popup.innerHTML = `<i class='fa fa-check-circle'></i> ${msg}`;
      popup.classList.add("show");
      setTimeout(() => popup.classList.remove("show"), 2500);
    }

    async function playAd(num) {
      if (currentAd) return;
      currentAd = num;

      const gif = document.getElementById(`gif${num}`);
      const overlay = document.getElementById(`overlay${num}`);
      const countdown = document.getElementById(`countdown${num}`);
      const loadingNext = document.getElementById(`loading${num}`);

      overlay.style.display = "none";
      gif.style.filter = "none";
      countdown.style.display = "flex";

      let timeLeft = 15;
      countdown.textContent = timeLeft;

      const interval = setInterval(async () => {
        timeLeft--;
        countdown.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(interval);
          countdown.style.display = "none";
          loadingNext.style.display = "block";
          const user = auth.currentUser;
          if (user) {
            const ref = doc(db, "users", user.uid);
            const snap = await getDoc(ref);
            const current = snap.data()?.balance || 0;
            await updateDoc(ref, { balance: current + 50 });
            showPopup("₦50 reward added!");
          }
          setTimeout(() => {
            gif.style.filter = "blur(6px)";
            gif.src = gifList[Math.floor(Math.random()*gifList.length)];
            overlay.style.display = "flex";
            overlay.querySelector("span").textContent = "Click to Watch Next Ad";
            loadingNext.style.display = "none";
            currentAd = null;
          }, 2000);
        }
      }, 1000);
    }
  </script>
</body>
</html>